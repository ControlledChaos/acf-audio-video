!function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=i(1),l=r(o),u=jQuery;acf.fields.audioVideo=acf.field.extend({type:"audioVideo",$el:null,actions:{ready:"initialize",append:"initialize"},events:{'click a[data-name="add"]':"add",'click a[data-name="edit"]':"edit",'click a[data-name="remove"]':"remove"},focus:function(){this.$el=this.$field.find(".acf-audio-video-uploader"),this.$inputContainer=this.$el.find(".acf-hidden"),this.$playerContainer=this.$el.find(".player-container"),this.o=acf.get_data(this.$el),this.allowedTypes=this.o.allowed_types.split(",").map(function(e){return e.trim()}),this.selectFrameType=this.o.general_type&&"both"!=this.o.general_type?this.o.general_type:["audio","video"],this.inputName=this.__getInputName()},__getInputName:function(){var e=this.$inputContainer.children(":first").attr("name").split("][");return 0==e[e.length-1].indexOf("field")?e.join("]["):(e.splice(e.length-1,1),e.join("][")+"]")},initialize:function(){},__getTag:function(e){return"undefined"==typeof e&&console.log({"this":this}),this.o.general_type&&"both"!==this.o.general_type?this.o.general_type:this.__guessTag(e)},__guessTag:function(e){for(var t=0;t<this.allowedTypes.length;t++)if(e[this.allowedTypes[t]])return this.o.audio_types.indexOf(this.allowedTypes[t])>-1?"audio":"video";return"video"},render:function(e){var t=this,i=e.tag,r=e.nextAttributes,n=e.prevAttributes,a=i?this.__getSources(i,r):[];if(this.$playerContainer.empty().removeClass("audio video"),this.$inputContainer.empty(),a.length){var s=this.$playerContainer.addClass(i).html(this.__getPlayerMarkup(i,r,a)).find(i);new MediaElementPlayer(s),Object.keys(r).forEach(function(e){return t.__insertHiddenInput(e,r[e])}),this.$el.addClass("has-value")}else this.__insertHiddenInput(),this.$el.removeClass("has-value");this.__triggerChange(n,r)},__getSources:function(e,t){var i=this;return this.allowedTypes.reduce(function(r,n){return t[n]?r.concat({type:i.__getMime(e,n),src:t[n]}):r},[])},__getMime:function(e,t){switch(t){case"mp3":return"audio/mpeg";case"wav":return"audio/wav";case"mp4":case"m4v":return"video/mp4";case"webm":return"video/webm";case"ogv":return"video/ogg";case"ogg":return e+"/ogg";case"flv":return"video/flv";default:return e+"/"+t}},__getPlayerMarkup:function(e,t,i){var r=this.__getTagAtts(e,t),n="video"==e?'height="360"':"";return'<div class="wp-'+e+"\">\n      <!--[if lt IE 9]><script>document.createElement('"+e+"');</script><![endif]-->\n      <"+e+' class="wp-'+e+'-shortcode" width="640" '+n+" "+r+" controls>\n        "+i.map(function(e){var t=e.type,i=e.src;return'<source type="'+t+'" src="'+i+'?_=1"/>'})+"\n      </"+e+">\n    </div>"},__getTagAtts:function(e,t){var i=this.o.playerDefaults[e];return Object.keys(i).concat("poster").reduce(function(e,i){return t.hasOwnProperty(i)?e+" "+i+'="'+t[i]+'"':e},"")},__insertHiddenInput:function(e,t){var i=this.$field.data(),r=(i.key,e?this.inputName+"["+e+"]":this.inputName);u('<input type="hidden">').attr({name:r,value:t}).appendTo(this.$inputContainer)},__triggerChange:function(e,t){e&&_.isEqual(e,t)||this.$inputContainer.children(":first").trigger("change")},add:function(){var e=this,t=this.$field,i=acf.get_closest_field(t,"repeater"),r=i.exists();this.selectFrame=new l["default"]({title:acf._e("audioVideo","select"),mode:"select",type:this.selectFrameType,field:t.data("key"),multiple:r,library:this.o.library,mime_types:this.o.allowed_types,select:function(a,o){var l=r&&t.closest(".acf-row");if(o>0){var d=function(){var e=t.data("key");if(t=!1,l.nextAll(".acf-row:visible").each(function(i,r){if(t=acf.get_field(e,u(r)))return!!t.find(".acf-file-uploader.has-value").exists()&&void(t=!1)}),!t){if(l=acf.fields.repeater.doFocus(i).add(),!l)return{v:!1};t=acf.get_field(e,l)}}();if("object"===("undefined"==typeof d?"undefined":s(d)))return d.v}var c=a.attributes.url.toLowerCase().split(".").pop(),f=n({},c,a.attributes.url),p=e.__getTag(f);a.attributes.image&&a.attributes.image.src&&!/wp-includes\/images\/media\/(audio|video).png$/.test(a.attributes.image.src)&&(f.poster=a.attributes.image.src);var h={tag:p,nextAttributes:f};e.set("$field",t).render(h)}}).open()},edit:function(){var e=this,t=this.__getAttributesFromInputs(),i=this.__getTag(t),r=this.__getShortcode(i,t);r&&!function(){var n=wp.media[i].edit(r).open();n.on("close",function(){var r=e.__getNextAttributes(i,n.media.attributes),a=(acf.get_closest_field(e.$field,"repeater"),{tag:i,nextAttributes:r,prevAttributes:t});e.render(a),n.detach()})}()},__getAttributesFromInputs:function(){return this.$inputContainer.children().toArray().reduce(function(e,t){var i=t.getAttribute("name").replace(/.*\[(.*)\]$/,"$1"),r=t.getAttribute("value");return a({},e,n({},i,r))},{})},__getShortcode:function(e,t){var i=Object.keys(t).reduce(function(e,i){return e+" "+i+'="'+t[i]+'"'},"");return i&&"["+e+" "+i+"][/"+e+"]"},__getNextAttributes:function(e,t){var i=this.o.playerDefaults[e],r={};return t.poster&&(r.poster=t.poster),Object.keys(i).forEach(function(e){t[e]!=i[e]&&(r[e]=t[e])}),this.allowedTypes.forEach(function(e){t[e]&&(r[e]=t[e])}),r},remove:function(){this.render({})}}),Object.keys(acf.fields.audioVideo).forEach(function(e){/^__/.test(e)&&(acf.fields.audioVideo[e]=acf.fields.audioVideo[e].bind(acf.fields.audioVideo))})},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},n=jQuery,a=function s(e){var t=this;i(this,s),this.createFrame=function(){var e=acf.media._get_media_frame_settings({title:t.settings.title,multiple:t.settings.multiple,library:{},states:[]},t.settings);t.settings.hasOwnProperty("mime_types")&&(e.library.type=t._getLibraryTypes());var i=wp.media.query(e.library);acf.isset(i,"mirroring","args")&&(i.mirroring.args._acfuploader=t.settings.field),e.states=[new wp.media.controller.Library({library:i,multiple:e.multiple,title:e.title,priority:20,filterable:"all",editable:!0,allowLocalEdits:!0})],acf.isset(wp,"media","controller","EditImage")&&e.states.push(new wp.media.controller.EditImage),t.frame=wp.media(e),t.frame.uploader.options.uploader.params.allowed_extensions=t.settings.mime_types,t.frame.acf=t.settings,t.addEvents(),t.frame=acf.media._add_media_frame_events(t.frame,t.settings)},this.addEvents=function(){t.frame.on("content:activate:browse",function(){var e=t.frame.content.get().toolbar,i=e.get("filters");i.filters.all.text=acf._e("audioVideo","all"),delete i.filters.uploaded,delete i.filters.audio,delete i.filters.video,delete i.filters.image,n.each(i.filters,function(e,i){null===i.props.type&&(i.props.type=t.settings.type)})})},this.open=function(){return setTimeout(function(){return t.frame.open()}),t},this._getLibraryTypes=function(){var e=t.settings.mime_types.split(",").map(function(e){return e.trim()}),i=t.settings.type instanceof String?t.settings.type:"video",r=e.map(function(e){return acf.fields.audioVideo.__getMime(i,e)});return t.settings.type instanceof Array&&e.indexOf("ogg")>-1&&r.push("audio/ogg"),r};var a=acf.get("post_id");return n.isNumeric(a)||(a=0),this.settings=r({mode:"select",title:"",button:"",type:"",field:"",mime_types:"",library:"all",multiple:!1,attachment:0,post_id:a,select:function(){}},e),this.settings.id&&(this.settings.attachment=this.settings.id),this.createFrame(),acf.media.frames.push(this.frame),this};t["default"]=a}]);
//# sourceMappingURL=acf-audio-video-field.min.js.map